define(function(d,e,c){var i="draggable" in document.createElement("span"),f={mode:"simulate",restrict:true},h={dragstart:function(){},drag:function(){},dragenter:function(){},dragleave:function(){},dragover:function(){},drop:function(){},dragend:function(){}};var g={disableSelect:function(){var j=document.body;cssText=document.body.style.cssText;j.style.cssText=cssText+"-webkit-user-select:none;-moz-user-select:none;user-select:none;";j.onselectstart=function(){return false}},enableSelect:function(){var j=document.body;j.style.cssText=cssText;j.onselectstart=function(){}}};var a=(function(){var o=3,k=false,n=document.createDocumentFragment(),m="setCapture" in document.documentElement,l=$('<div style="display:none;position:absolute;left:0;top:0;filter:alpha(opacity=20);opacity:0.2;cursor:move;z-index:8000;"><div style="border:'+o+'px solid #000;background-color:#fff;"></div></div>'),j=$(l[0].firstChild);l.appendTo(document.body);return{setDefaultIcon:function(p){if(k){return}l.html("");j.appendTo(l);j.css({width:p.outerWidth()-o*2+"px",height:p.outerHeight()-o*2+"px"});l.show();this.setCapture()},setDragImage:function(r,q,p,s){k=true;p=r.offsetX-p;s=r.offsetY-s;$(q).css({position:"relative",left:p,top:s});n.appendChild(j[0]);l.html("");l[0].appendChild(q);l.show();this.setCapture()},setPosition:function(q,p){q=b.verifyBoundary(q,p);l.css({left:q.left+"px",top:q.top+"px"})},hide:function(p){var q;this.releaseCapture();if(p&&!p._drop&&p.dropElement){q=p.dragTarget.offset();l.animate(q,{duration:400,complete:function(){l.hide()}})}else{l.hide()}k=false},setCapture:function(){m&&l[0].setCapture()},releaseCapture:function(){m&&l[0].releaseCapture()}}})();var b={init:function(j,k){j=$.extend({},f,j);j.callbacks=$.extend({},h,j.callbacks);j.dragElement=$(j.dragElement);j.dragTarget=$(j.dragTarget);j.dropElement=$(j.dropElement);if(j.dragElement.length===0){return}if(j.dragTarget.length===0){j.dragTarget=j.dragElement}if(j.dropElement.length===0){j.dropElement=null}b.adapterMode(j)},adapterMode:function(j){switch(j.mode){case"native":j.dragElement.attr("draggable","true");i&&this.nativeDnD(j);break;case"auto":j.dragElement.attr("draggable","true");if(i){this.nativeDnD(j)}else{this.simulateDnD(j)}break;default:this.simulateDnD(j);break}},nativeDnD:function(l){var k=this,m=l.callbacks,j=l.dragElement[0],n;if(l.dropElement){n=l.dropElement[0]}l.dragElement.on("dragstart",function(o){l.offset={left:o.originalEvent.offsetX,top:o.originalEvent.offsetY};k.fixEvent(o,l);m.dragstart.call(j,o)}).on("drag",function(o){k.fixEvent(o,l);m.drag.call(j,o)}).on("dragend",function(o){k.fixEvent(o,l);m.dragend.call(j,o)});if(l.dropElement){l.dropElement.on("dragenter",function(o){k.fixEvent(o,l);m.dragenter.call(n,o)}).on("dragover",function(o){k.fixEvent(o,l);o.preventDefault&&o.preventDefault();m.dragover.call(n,o)}).on("dragleave",function(o){k.fixEvent(o,l);m.dragleave.call(n,o)}).on("drop",function(o){k.fixEvent(o,l);o.stopPropagation&&o.stopPropagation();o.preventDefault&&o.preventDefault();m.drop.call(n,o);return false})}},fixEvent:function(k,j){k.dataTransfer=k.originalEvent.dataTransfer;if(i){k.clientX=k.originalEvent.clientX;k.clientY=k.originalEvent.clientY}}};$.extend(b,{simulateDnD:function(k){var j=this;k.draggable=false;k._mouseenter=false;k.offset={left:0,top:0};k._offsetParent=k.dragTarget.offsetParent();k.dragElement.mousedown(function(l){j.fixEvent(l,k);j.startDrag(l,k);l.preventDefault()});$(document).mouseup(function(l){if(!k.draggable){return}j.fixEvent(l,k);j.stopDrag(l,k)}).mousemove(function(l){if(!k.draggable){return}j.fixEvent(l,k);if(l.which>0){j.tween(l,k);j.simulateEvents(l,k)}else{j.stopDrag(l,k)}})},createDataTransfer:function(j){return{_data:{},setData:function(k,l){this._data[k]=l},getData:function(k){return this._data[k]},clearData:function(k){k=""+k;if(k){delete this._data[k]}else{this._data={}}},setDragImage:function(l,k,m){k=parseInt(k,10)||0;m=parseInt(m,10)||0;a.setDragImage(j,l,k,m)}}},isPointInElement:function(p,u){var o=false,r=$(document),t=p.clientX,s=p.clientY,l=u.dropElement,m=l.offset(),q=l.outerWidth(),n=l.outerHeight(),k=t+r.scrollLeft()-m.left,j=s+r.scrollTop()-m.top;if(k>0&&j>0&&k<q&&j<n){o=true}return o},simulateEvents:function(k,j){this.simulateDrag(k,j);if(!j.dropElement){return}if(this.isPointInElement(k,j)){if(j._mouseenter==false){j._mouseenter=true;this.simulateDragEnter(k,j)}this.simulateDragOver(k,j)}else{if(j._mouseenter==true){j._mouseenter=false;this.simulateDragLeave(k,j)}}},simulateDragStart:function(k,j){j._drop=false;k.dataTransfer=j.dataTransfer=this.createDataTransfer(k);j.callbacks.dragstart.call(j.dragTarget[0],k)},simulateDrag:function(k,j){k.dataTransfer=j.dataTransfer;j.callbacks.drag.call(j.dragTarget[0],k)},simulateDragEnter:function(k,j){k.dataTransfer=j.dataTransfer;j.callbacks.dragenter.call(j.dropElement[0],k)},simulateDragOver:function(k,j){k.dataTransfer=j.dataTransfer;j.callbacks.dragover.call(j.dropElement[0],k)},simulateDragLeave:function(k,j){k.dataTransfer=j.dataTransfer;j.callbacks.dragleave.call(j.dropElement[0],k)},simulateDrop:function(k,j){j._drop=true;k.dataTransfer=j.dataTransfer;k.stopPropagation&&k.stopPropagation();j.callbacks.drop.call(j.dropElement[0],k)},simulateDragEnd:function(l,k){var m=k.offset,j=k._offsetParent.offset();pos=this.verifyBoundary({width:m.width,height:m.height,left:l.clientX-m.left,top:l.clientY-m.top},k);l.dataTransfer=k.dataTransfer;if(l.offsetX===undefined){l.offsetX=m.left;l.offsetY=m.top}if(k._offsetParent[0].tagName.toLowerCase()==="body"){j.left=0;j.top=0}pos.left=pos.left-j.left-this.getBorderWidth(k._offsetParent,"left");pos.top=pos.top-j.top-this.getBorderWidth(k._offsetParent,"top");k.callbacks.dragend.call(k.dragTarget[0],l,pos)},startDrag:function(k,j){j.offset=this.getOffset(k,j);j.draggable=true;this.simulateDragStart(k,j);a.setPosition({width:j.offset.width,height:j.offset.height,left:k.clientX-j.offset.left,top:k.clientY-j.offset.top},j);a.setDefaultIcon(j.dragTarget)},getOffset:function(m,k){var l=k.dragTarget,n=l.offset(),j={width:l.outerWidth(),height:l.outerHeight()};j.left=m.clientX-n.left;j.top=m.clientY-n.top;return j},tween:function(k,j){var l=j.offset;a.setPosition({width:l.width,height:l.height,left:k.clientX-l.left,top:k.clientY-l.top},j)},stopDrag:function(k,j){if(j.dropElement&&this.isPointInElement(k,j)){this.simulateDrop(k,j)}if(j._mouseenter){j._mouseenter=false;this.simulateDragLeave(k,j)}this.simulateDragEnd(k,j);a.hide(j);j.draggable=false},getBorderWidth:function(j,k){return parseInt(j.css("border-"+k+"-width"),10)||0},verifyBoundary:function(l,s){var q=s._offsetParent,k,m,p,r,j,n,o;if(s.restrict&&q[0].tagName.toLowerCase()!=="body"){o=q.offset();k=q.outerWidth();m=q.outerHeight();p=o.top+this.getBorderWidth(q,"top");r=o.left+this.getBorderWidth(q,"left");j=o.left+k-l.width-this.getBorderWidth(q,"right");n=o.top+m-l.height-this.getBorderWidth(q,"bottom")}else{k=$(window).width();m=$(window).height();p=$(window).scrollTop();r=$(window).scrollLeft();j=k+r-l.width;n=m+p-l.height}l.left=l.left>=r?l.left:r;l.left=l.left<=j?l.left:j;l.top=l.top>=p?l.top:p;l.top=l.top<=n?l.top:n;return l}});c.exports={enableDrag:function(j){b.init(j)}}});